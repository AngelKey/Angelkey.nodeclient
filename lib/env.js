// Generated by IcedCoffeeScript 1.7.1-a
(function() {
  var Env, FN, RunMode, SRV, constants, home, join, make_email, make_full_username, _env, _ref;

  home = require('./path').home;

  join = require('path').join;

  constants = require('./constants').constants;

  _ref = require('./util'), make_full_username = _ref.make_full_username, make_email = _ref.make_email;

  FN = constants.filenames;

  SRV = constants.server;

  RunMode = (function() {
    RunMode.prototype.DEVEL = 0;

    RunMode.prototype.PROD = 1;

    function RunMode(s) {
      var m, t, _ref1;
      t = {
        devel: this.DEVEL,
        prod: this.PROD
      };
      _ref1 = (s != null) && ((m = t[s]) != null) ? [m, s, true] : [this.PROD, "prod", false], this._v = _ref1[0], this._name = _ref1[1], this._chosen = _ref1[2];
    }

    RunMode.prototype.is_devel = function() {
      return this._v === this.DEVEL;
    };

    RunMode.prototype.is_prod = function() {
      return this._v === this.PROD;
    };

    RunMode.prototype.toString = function() {
      return this._name;
    };

    RunMode.prototype.chosen = function() {
      return this._chosen;
    };

    RunMode.prototype.config_dir = function() {
      return this._name;
    };

    return RunMode;

  })();

  Env = (function() {
    function Env() {
      this.env = process.env;
      this.argv = null;
      this.config = null;
      this.session = null;
    }

    Env.prototype.set_config = function(c) {
      return this.config = c;
    };

    Env.prototype.set_session = function(s) {
      return this.session = s;
    };

    Env.prototype.set_argv = function(a) {
      return this.argv = a;
    };

    Env.prototype.get_opt = function(_arg) {
      var arg, co, config, dflt, env, _ref1;
      env = _arg.env, arg = _arg.arg, config = _arg.config, dflt = _arg.dflt;
      co = (_ref1 = this.config) != null ? _ref1.obj() : void 0;
      return (typeof env === "function" ? env(this.env) : void 0) || (typeof arg === "function" ? arg(this.argv) : void 0) || ((co != null) && (typeof config === "function" ? config(co) : void 0)) || (typeof dflt === "function" ? dflt() : void 0) || null;
    };

    Env.prototype.get_port = function() {
      return this.get_opt({
        env: function(e) {
          return e.KEYBASE_PORT;
        },
        arg: function(a) {
          return a.port;
        },
        config: function(c) {
          var _ref1;
          return (_ref1 = c.server) != null ? _ref1.port : void 0;
        },
        dflt: function() {
          return SRV.port;
        }
      });
    };

    Env.prototype.get_config_filename = function() {
      return this.get_opt({
        env: function(e) {
          return e.KEYBASE_CONFIG_FILE;
        },
        arg: function(a) {
          return a.config;
        },
        dflt: (function(_this) {
          return function() {
            return join(_this.get_home(), FN.config_dir, FN.config_file);
          };
        })(this)
      });
    };

    Env.prototype.get_session_filename = function() {
      return this.get_opt({
        env: function(e) {
          return e.KEYBASE_SESSION_FILE;
        },
        arg: function(a) {
          return a.session_file;
        },
        config: function(c) {
          var _ref1;
          return c != null ? (_ref1 = c.files) != null ? _ref1.session : void 0 : void 0;
        },
        dflt: (function(_this) {
          return function() {
            return join(_this.get_home(), FN.config_dir, FN.session_file);
          };
        })(this)
      });
    };

    Env.prototype.get_db_filename = function() {
      return this.get_opt({
        env: function(e) {
          return e.KEYBASE_DB_FILE;
        },
        arg: function(a) {
          return a.db_file;
        },
        config: function(c) {
          var _ref1;
          return c != null ? (_ref1 = c.files) != null ? _ref1.db : void 0 : void 0;
        },
        dflt: (function(_this) {
          return function() {
            return join(_this.get_home(), FN.config_dir, FN.db_file);
          };
        })(this)
      });
    };

    Env.prototype.get_tmp_keyring_dir = function() {
      return this.get_opt({
        env: function(e) {
          return e.KEYBASE_TMP_KEYRING_DIR;
        },
        arg: function(a) {
          return a.tmp_keyring_dir;
        },
        config: function(c) {
          var _ref1;
          return c != null ? (_ref1 = c.files) != null ? _ref1.tmp_keyring_dir : void 0 : void 0;
        },
        dflt: (function(_this) {
          return function() {
            return join(_this.get_home(), FN.config_dir, FN.tmp_keyring_dir);
          };
        })(this)
      });
    };

    Env.prototype.get_preserve_tmp_keyring = function() {
      return this.get_opt({
        env: function(e) {
          return e.KEYBASE_PRESERVE_TMP_KEYRING;
        },
        arg: function(a) {
          return a.preserve_tmp_keyring;
        },
        dflt: function() {
          return false;
        }
      });
    };

    Env.prototype.get_host = function() {
      return this.get_opt({
        env: function(e) {
          return e.KEYBASE_HOST;
        },
        arg: function(a) {
          return a.host;
        },
        config: function(c) {
          var _ref1;
          return (_ref1 = c.server) != null ? _ref1.host : void 0;
        },
        dflt: function() {
          return SRV.host;
        }
      });
    };

    Env.prototype.get_debug = function() {
      return this.get_opt({
        env: function(e) {
          return e.KEYBASE_DEBUG;
        },
        arg: function(a) {
          return a.debug;
        },
        config: function(c) {
          var _ref1;
          return (_ref1 = c.run) != null ? _ref1.d : void 0;
        },
        dflt: function() {
          return false;
        }
      });
    };

    Env.prototype.get_no_tls = function() {
      return this.get_opt({
        env: function(e) {
          return e.KEYBASE_NO_TLS;
        },
        arg: function(a) {
          return a.no_tls;
        },
        config: function(c) {
          var _ref1;
          return (_ref1 = c.server) != null ? _ref1.no_tls : void 0;
        },
        dflt: function() {
          return SRV.no_tls;
        }
      });
    };

    Env.prototype.get_api_uri_prefix = function() {
      return this.get_opt({
        env: function(e) {
          return e.KEYBASE_API_URI_PREFIX;
        },
        arg: function(a) {
          return a.api_uri_prefix;
        },
        config: function(c) {
          var _ref1;
          return (_ref1 = c.server) != null ? _ref1.api_uri_prefix : void 0;
        },
        dflt: function() {
          return SRV.api_uri_prefix;
        }
      });
    };

    Env.prototype.get_run_mode = function() {
      var raw;
      if (!this._run_mode) {
        raw = this.get_opt({
          env: function(e) {
            return e.KEYBASE_RUN_MODE;
          },
          arg: function(a) {
            return a.m;
          },
          config: function(c) {
            var _ref1;
            return (_ref1 = c.run) != null ? _ref1.mode : void 0;
          },
          dflt: null
        });
        this._run_mode = new RunMode(raw);
      }
      return this._run_mode;
    };

    Env.prototype.get_log_level = function() {
      return this.get_opt({
        env: function(e) {
          return e.KEYBASE_LOG_LEVEL;
        },
        arg: function(a) {
          return a.l;
        },
        config: function(c) {
          var _ref1;
          return (_ref1 = c.run) != null ? _ref1.log_level : void 0;
        },
        dflt: function() {
          return null;
        }
      });
    };

    Env.prototype.get_passphrase = function() {
      return this.get_opt({
        env: function(e) {
          return e.KEYBASE_PASSPHRASE;
        },
        arg: function(a) {
          return a.passphrase;
        },
        config: function(c) {
          var _ref1;
          return (_ref1 = c.user) != null ? _ref1.passphrase : void 0;
        },
        dflt: function() {
          return null;
        }
      });
    };

    Env.prototype.get_username = function() {
      return this.get_opt({
        env: function(e) {
          return e.KEYBASE_USERNAME;
        },
        arg: function(a) {
          return a.username;
        },
        config: function(c) {
          var _ref1;
          return (_ref1 = c.user) != null ? _ref1.name : void 0;
        },
        dflt: function() {
          return null;
        }
      });
    };

    Env.prototype.get_uid = function() {
      return this.get_opt({
        env: function(e) {
          return e.KEYBASE_UID;
        },
        arg: function(a) {
          return a.uid;
        },
        config: function(c) {
          var _ref1;
          return (_ref1 = c.user) != null ? _ref1.id : void 0;
        },
        dflt: function() {
          return null;
        }
      });
    };

    Env.prototype.get_email = function() {
      return this.get_opt({
        env: function(e) {
          return e.KEYBASE_EMAIL;
        },
        arg: function(a) {
          return a.email;
        },
        config: function(c) {
          var _ref1;
          return (_ref1 = c.user) != null ? _ref1.email : void 0;
        },
        dflt: function() {
          return null;
        }
      });
    };

    Env.prototype.get_home = function(null_ok) {
      if (null_ok == null) {
        null_ok = false;
      }
      return this.get_opt({
        env: function(e) {
          return e.KEYBASE_HOME_DIR;
        },
        arg: function(a) {
          return a.homedir;
        },
        dflt: function() {
          if (null_ok) {
            return null;
          } else {
            return home();
          }
        }
      });
    };

    Env.prototype.get_home_gnupg_dir = function(null_ok) {
      var ret;
      if (null_ok == null) {
        null_ok = false;
      }
      ret = this.get_home(null_ok);
      if (ret != null) {
        ret = join(ret, ".gnupg");
      }
      return ret;
    };

    Env.prototype.get_gpg_cmd = function() {
      return this.get_opt({
        env: function(e) {
          return e.KEYBASE_GPG;
        },
        arg: function(a) {
          return a.gpg;
        },
        config: function(c) {
          return c.gpg;
        },
        dflt: function() {
          return null;
        }
      });
    };

    Env.prototype.get_proxy = function() {
      return this.get_opt({
        env: function(e) {
          return e.http_proxy || e.https_proxy;
        },
        arg: function(a) {
          return a.proxy;
        },
        config: function(c) {
          var _ref1;
          return (_ref1 = c.proxy) != null ? _ref1.url : void 0;
        },
        dflt: function() {
          return null;
        }
      });
    };

    Env.prototype.get_proxy_ca_certs = function() {
      return this.get_opt({
        env: function(e) {
          return e.KEYBASE_PROXY_CA_CERTS;
        },
        arg: function(a) {
          return a.proxy_ca_certs;
        },
        config: function(c) {
          var _ref1;
          return (_ref1 = c.proxy) != null ? _ref1.ca_certs : void 0;
        },
        dflt: function() {
          return null;
        }
      });
    };

    Env.prototype.get_loopback_port_range = function() {
      var parse_range;
      parse_range = function(s) {
        var i, m, _i, _len, _ref1, _results;
        if (s == null) {
          return null;
        } else if (!(m = s.match(/^(\d+)-(\d+)$/))) {
          _ref1 = m.slice(1);
          _results = [];
          for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
            i = _ref1[_i];
            _results.push(parseInt(i, 10));
          }
          return _results;
        } else {
          return null;
        }
      };
      return this.get_opt({
        env: function(e) {
          return parse_range(e.KEYBASE_LOOPBACK_PORT_RANGE);
        },
        arg: function(a) {
          return parse_range(a.loopback_port_range);
        },
        config: function(c) {
          return c.loopback_port_range;
        },
        dflt: function() {
          return constants.loopback_port_range;
        }
      });
    };

    Env.prototype.get_args = function() {
      return this.argv._;
    };

    Env.prototype.get_argv = function() {
      return this.argv;
    };

    Env.prototype.is_configured = function() {
      return this.get_username() != null;
    };

    Env.prototype.keybase_email = function() {
      return make_email(this.get_username());
    };

    Env.prototype.keybase_full_username = function() {
      return make_full_username(this.get_username());
    };

    Env.prototype.make_pgp_uid = function() {
      return {
        username: this.keybase_full_username(),
        email: this.keybase_email()
      };
    };

    return Env;

  })();

  _env = null;

  exports.init_env = function(a) {
    return _env = new Env;
  };

  exports.env = function() {
    return _env;
  };

}).call(this);
